<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 후 홈화면 지도</title>
</head>
<body>
    <h1>로그인 전 홈화면 지도</h1>
    <p>- 사용자 위치정보 표시, 현재 위치를 지도 중심좌표로 설정</p> 
    <p>- 일반 공연과 즐겨찾기 공연 마커 구분</p>
    <!--지도를 담을 영역-->
    <div id = "login_map" style = "width:500px; height: 400px;"></div>
    <!--지도 아래 공연 정보 리스트-->
    <section id = "inform_list">
        <p>오늘 공연 정보</p>
    </section>    
    <!--지도 api 불러오기-->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8692f5c3c759c152297171d014cffebe"></script>
    
    <!--지도를 생성해 영역에 담기-->
    <script>
        var container = document.getElementById('login_map'); //지도를 담을 영역의 DOM 레퍼런스
        var options = { //지도를 생성할 때 필요한 기본 옵션
        center: new kakao.maps.LatLng(37.55534870467689, 126.93710965061135), //지도의 중심좌표: 신촌역
        level: 4 //지도의 레벨(확대, 축소 정도. 숫자가 클수록 지도 축소)
        };

        var login_map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

        // 사용자 위치 표시 및 지도 중심으로 설정 
        if (navigator.geolocation){ //geolocation 사용 가능할 때
            // 현재 위치 
            navigator.geolocation.getCurrentPosition(function(position){
                var lat = position.coords.latitude, // 위도
                lon = position.coords.longitude; // 경도 

                var locPosition = new kakao.maps.LatLng(lat, lon); // 현재 위치 생성
                displayMarker(locPosition); // 마커 표시 및 지도 중심 옮기기 
            })
        }
        else{ // geolocation 사용 불가  
            var locPosition = new kakao.maps.LatLng(37.55534870467689, 126.93710965061135); // 불가 시 중심 좌표: 신촌역
            displayMarker(locPosition);
        }

        function displayMarker(locPosition){
            var imageSrc = "https://ifh.cc/g/p8Gfpv.png"; // 사용자 위치 마커(빨간색)
            // 마커 이미지의 이미지 크기
            var imageSize = new kakao.maps.Size(24, 30); 

            // 마커 이미지 생성    
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 
            var marker = new kakao.maps.Marker({
                map: login_map,
                position: locPosition,
                image : markerImage // 마커 이미지 
            });

            // 지도 중심좌표를 현재 위치로 변경 
            login_map.setCenter(locPosition);
        }

        // 즐겨찾기 공연 마커
        // 마커를 표시할 위치와 title 객체 배열 
        var favorite_positions = [
            {
                title: '부천맨', 
                latlng: new kakao.maps.LatLng(37.48335519999797, 126.78244137024062),
                message: '부천 다이내믹 시티'
            },
            {
                title: '돈까스', 
                latlng: new kakao.maps.LatLng(37.48517619625516, 126.78296467837502),
                message: '돈까스 먹고싶다'
            },
            {
                title: '이독수',  
                latlng: new kakao.maps.LatLng(37.555961261903036, 126.93688278758694),
                message: "저의 첫 버스킹 많은 기대 바랍니다"
            },
            {
                title: '유무진', 
                latlng: new kakao.maps.LatLng(37.55765513907933, 126.93688701769658),
                message: "오늘 신곡 '신호등' 공연 예정입니다!'"
            },
        ];
        
        // 마커 이미지의 이미지 주소
        var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; // 즐겨찾기 마커(노란색)

        for (var i = 0; i < favorite_positions.length; i ++) {

            // 마커 이미지의 이미지 크기
            var imageSize = new kakao.maps.Size(24, 35); 

            // 마커 이미지 생성    
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 

            // 마커 생성
            var marker = new kakao.maps.Marker({
                map: login_map, // 마커를 표시할 지도
                position: favorite_positions[i].latlng, // 마커를 표시할 위치
                title : favorite_positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시
                image : markerImage // 마커 이미지 
            });
        }

        // 공연 정보 리스트 띄우기  
        for (var i = 0; i < favorite_positions.length; i ++){
            var live_inform = document.createTextNode("공연 이름: " + favorite_positions[i].title + " / 공연 소개: " + favorite_positions[i].message + " / " );
            live_inform.id = favorite_positions[i].title;
            document.getElementById('inform_list').appendChild(live_inform);
        }        

        // 일반 공연 마커 
        // 기본 마커 이미지로 표시할 때 
        var normal_positions = [
            {
                title: '냠냐', 
                latlng: new kakao.maps.LatLng(37.484022123688185, 126.78253836856217),
                message: "수박 먹고싶다"
            },
            {
                title: 'MC 연세',
                latlng: new kakao.maps.LatLng(37.55572667440016, 126.93627184712138),
                message: "연세 버스킹!"
            },

            {
                title: '라이온킹',
                latlng: new kakao.maps.LatLng(37.55689796127638,126.9362538733116),
                message: "밴드 공연입니다 구경오세요~"
            }
        ];
        
        for (var i = 0; i < normal_positions.length; i ++) {
            // 마커를 생성
            var marker = new kakao.maps.Marker({
                map: login_map, // 마커를 표시할 지도
                position: normal_positions[i].latlng, // 마커를 표시할 위치
                title : normal_positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시
            });
        }        

        // 공연 정보 리스트 띄우기  
        for (var i = 0; i < normal_positions.length; i ++){
            var live_inform = document.createTextNode("공연 이름: " + normal_positions[i].title + " /  공연 소개: " +  normal_positions[i].message + " / " );
            live_inform.id = normal_positions[i].title;
            document.getElementById('inform_list').appendChild(live_inform);
        }      

    </script>
    <h1>달력: 공연 클릭 시 해당 공연 지도</h1>
    <a href="{% url 'each_map' %}">이독수</a>

</body>

</html>